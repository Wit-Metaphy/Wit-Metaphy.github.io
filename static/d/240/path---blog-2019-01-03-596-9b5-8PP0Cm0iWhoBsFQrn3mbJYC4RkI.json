{"data":{"markdownRemark":{"html":"<h1>Overview</h1>\n<ul>\n<li>Debian 9</li>\n<li>shadowsocks-libev (<a href=\"https://github.com/shadowsocks/shadowsocks-libev\">Github</a>)</li>\n<li>simple-obfs (<a href=\"https://github.com/shadowsocks/simple-obfs\">Github</a>)</li>\n</ul>\n<h1>Todo</h1>\n<h2>Install Debian 9</h2>\n<p>☕️</p>\n<h2>Install shadowsocks-libev</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">sh -c <span class=\"token string\">'printf \"deb http://deb.debian.org/debian stretch-backports main\" > /etc/apt/sources.list.d/stretch-backports.list'</span>\napt update\n\napt -t stretch-backports <span class=\"token function\">install</span> shadowsocks-libev</code></pre></div>\n<h2>Use shadowsocks-libev</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">systemctl status shadowsocks-libev\nsystemctl start shadowsocks-libev\nsystemctl stop shadowsocks-libev\nsystemctl restart shadowsocks-libev</code></pre></div>\n<p>or</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">service</span> shadowsocks-libev status\n<span class=\"token function\">service</span> shadowsocks-libev start\n<span class=\"token function\">service</span> shadowsocks-libev stop\n<span class=\"token function\">service</span> shadowsocks-libev restart</code></pre></div>\n<p>or</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ss-server -c /etc/shadowsocks-libev/config.json</code></pre></div>\n<h2>Config of shadowsocks-libev</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">vi</span> /etc/shadowsocks-libev/config.json</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"server\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"0.0.0.0\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"mode\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"tcp_and_udp\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"server_port\"</span><span class=\"token operator\">:</span><span class=\"token number\">443</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"local_port\"</span><span class=\"token operator\">:</span><span class=\"token number\">1080</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"password\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"timeout\"</span><span class=\"token operator\">:</span><span class=\"token number\">60</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"method\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"chacha20-ietf-poly1305\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>Tip</p>\n<p>改完记得重启服务</p>\n</li>\n</ul>\n<h2>Client</h2>\n<ul>\n<li>os x → ShadowsocksX-NG</li>\n<li>android → shadowsocks+simple-obfs</li>\n<li>ios → shadowrocket</li>\n</ul>\n<p>如果加了混淆，配置如下</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">plugin:obfs-local;\nplugin-opt:obfs=tls;obfs-host:amazon.com</code></pre></div>\n<h1>Faster?</h1>\n<h2>Enable Google BBR</h2>\n<p>这就是使用Debian 9的原因，不用换内核</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token keyword\">echo</span> <span class=\"token string\">\"net.core.default_qdisc=fq\"</span> <span class=\"token operator\">>></span> /etc/sysctl.conf\n<span class=\"token keyword\">echo</span> <span class=\"token string\">\"net.ipv4.tcp_congestion_control=bbr\"</span> <span class=\"token operator\">>></span> /etc/sysctl.conf\nsysctl -p</code></pre></div>\n<p>执行下面三条指令，出现bbr说明启用了</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">sysctl net.ipv4.tcp_available_congestion_control\nsysctl net.ipv4.tcp_congestion_control\nlsmod <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> bbr</code></pre></div>\n<h2>Config of TCP</h2>\n<div class=\"gatsby-highlight\" data-language=\"txt\"><pre class=\"language-txt\"><code class=\"language-txt\">// config.txt\nnet.core.default_qdisc = fq\nnet.ipv4.tcp_congestion_control = bbr\nnet.ipv4.tcp_fastopen = 3\n\nfs.file-max = 1024000\nnet.core.rmem_max = 67108864\nnet.core.wmem_max = 67108864\nnet.core.rmem_default = 65536\nnet.core.wmem_default = 65536\nnet.core.netdev_max_backlog = 4096\nnet.core.somaxconn = 4096\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_tw_recycle = 0\nnet.ipv4.tcp_fin_timeout = 30\nnet.ipv4.tcp_keepalive_time = 1200\nnet.ipv4.ip_local_port_range = 10000 65000\nnet.ipv4.tcp_max_syn_backlog = 4096\nnet.ipv4.tcp_max_tw_buckets = 5000\nnet.ipv4.tcp_rmem = 4096 87380 67108864\nnet.ipv4.tcp_wmem = 4096 65536 67108864\nnet.ipv4.tcp_mtu_probing = 1\nnet.ipv4.ip_forward = 1\n\ncat config.txt &gt;&gt; /etc/sysctl.conf\nsysctl -p</code></pre></div>\n<h1>Safe??</h1>\n<h2>Install simple-obfs</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">apt -t stretch-backports <span class=\"token function\">install</span> simple-obfs\n<span class=\"token function\">vi</span> /etc/shadowsocks-libev/config.json</code></pre></div>\n<p>添加两个字段</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"plugin\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"obfs-server\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"plugin_opts\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"obfs=tls;failover:127.0.0.1:80\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>重启ss服务</p>\n<h2>Install nginx</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">apt <span class=\"token function\">install</span> nginx\nsystemctl status nginx</code></pre></div>\n<p>nginx默认监听80端口</p>\n<p>浏览器访问<ip>:443将自动跳转至nginx首页</p>\n<h1>Something Useful</h1>\n<p>查看端口</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">netstat</span> -ntpl</code></pre></div>","frontmatter":{"date":"January 03, 2019","path":"/blog/2019-01-03","title":"科学上网"}}},"pageContext":{}}