{"data":{"markdownRemark":{"html":"<h1>科学上网</h1>\n<h1>Overview</h1>\n<ul>\n<li>Debian 9</li>\n<li>shadowsocks-libev (<a href=\"https://github.com/shadowsocks/shadowsocks-libev\">Github</a>)</li>\n<li>simple-obfs (<a href=\"https://github.com/shadowsocks/simple-obfs\">Github</a>)</li>\n</ul>\n<h1>Todo</h1>\n<h2>Install Debian 9</h2>\n<p>☕️</p>\n<h2>Install shadowsocks-libev</h2>\n<pre><code>sh -c 'printf \"deb http://deb.debian.org/debian stretch-backports main\" > /etc/apt/sources.list.d/stretch-backports.list'\napt update\n\napt -t stretch-backports install shadowsocks-libev\n</code></pre>\n<h2>Use shadowsocks-libev</h2>\n<pre><code>systemctl status shadowsocks-libev\nsystemctl start shadowsocks-libev\nsystemctl stop shadowsocks-libev\nsystemctl restart shadowsocks-libev\n</code></pre>\n<p>or</p>\n<pre><code>service shadowsocks-libev status\nservice shadowsocks-libev start\nservice shadowsocks-libev stop\nservice shadowsocks-libev restart\n</code></pre>\n<p>or</p>\n<pre><code>ss-server -c /etc/shadowsocks-libev/config.json\n</code></pre>\n<h2>Config of shadowsocks-libev</h2>\n<pre><code>vi /etc/shadowsocks-libev/config.json\n\n{\n    \"server\":[\"0.0.0.0\"],\n    \"mode\":\"tcp_and_udp\",\n    \"server_port\":443,\n    \"local_port\":1080,\n    \"password\":\"\",\n    \"timeout\":60,\n    \"method\":\"chacha20-ietf-poly1305\"\n}\n</code></pre>\n<ul>\n<li>\n<p>Tip</p>\n<p>改完记得重启服务</p>\n</li>\n</ul>\n<h2>Client</h2>\n<ul>\n<li>os x → ShadowsocksX-NG</li>\n<li>android → shadowsocks+simple-obfs</li>\n<li>ios → shadowrocket</li>\n</ul>\n<p>如果加了混淆，配置如下</p>\n<pre><code>plugin:obfs-local;\nplugin-opt:obfs=tls;obfs-host:amazon.com\n</code></pre>\n<h1>Faster?</h1>\n<h2>Enable Google BBR</h2>\n<p>这就是使用Debian 9的原因，不用换内核</p>\n<pre><code>echo \"net.core.default_qdisc=fq\" >> /etc/sysctl.conf\necho \"net.ipv4.tcp_congestion_control=bbr\" >> /etc/sysctl.conf\nsysctl -p\n</code></pre>\n<p>执行下面三条指令，出现bbr说明启用了</p>\n<pre><code>sysctl net.ipv4.tcp_available_congestion_control\nsysctl net.ipv4.tcp_congestion_control\nlsmod | grep bbr\n</code></pre>\n<h2>Config of TCP</h2>\n<pre><code>// config.txt\nnet.core.default_qdisc = fq\nnet.ipv4.tcp_congestion_control = bbr\nnet.ipv4.tcp_fastopen = 3\n\nfs.file-max = 1024000\nnet.core.rmem_max = 67108864\nnet.core.wmem_max = 67108864\nnet.core.rmem_default = 65536\nnet.core.wmem_default = 65536\nnet.core.netdev_max_backlog = 4096\nnet.core.somaxconn = 4096\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_tw_recycle = 0\nnet.ipv4.tcp_fin_timeout = 30\nnet.ipv4.tcp_keepalive_time = 1200\nnet.ipv4.ip_local_port_range = 10000 65000\nnet.ipv4.tcp_max_syn_backlog = 4096\nnet.ipv4.tcp_max_tw_buckets = 5000\nnet.ipv4.tcp_rmem = 4096 87380 67108864\nnet.ipv4.tcp_wmem = 4096 65536 67108864\nnet.ipv4.tcp_mtu_probing = 1\nnet.ipv4.ip_forward = 1\n\ncat config.txt >> /etc/sysctl.conf\nsysctl -p\n</code></pre>\n<h1>Safe??</h1>\n<h2>Install simple-obfs</h2>\n<pre><code>apt -t stretch-backports install simple-obfs\n\nvi /etc/shadowsocks-libev/config.json\n</code></pre>\n<p>添加两个字段</p>\n<pre><code>{\n    \"plugin\": \"obfs-server\",\n    \"plugin_opts\": \"obfs=tls;failover:127.0.0.1:80\"\n}\n</code></pre>\n<p>重启ss服务</p>\n<h2>Install nginx</h2>\n<pre><code>apt install nginx\n\nsystemctl status nginx\n</code></pre>\n<p>nginx默认监听80端口</p>\n<p>浏览器访问<ip>:443将自动跳转至nginx首页</p>\n<h1>Something Useful</h1>\n<p>查看端口</p>\n<pre><code>netstat -ntpl\n</code></pre>","frontmatter":{"date":"January 03, 2019","path":"/blog/2019-01-03","title":"科学上网"}}},"pageContext":{}}